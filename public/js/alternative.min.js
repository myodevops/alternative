myo={UI:{alertType:{OperativeSuccess:0,OperativeInfo:1,OperativeWarning:2,OperativeError:3,RuntimeError:4},newRecordUUID:"af24f1d4-2916-4c55-a526-9f6217466ec3",dttable:null,OnDeleteActionFormAlert:!1,OnModifyActionFormAlert:!1,initializeDataTable(e){table=document.getElementById(e),"undefined"!=typeof table&&null!=table||alert('Undefined datatableform "'+e+'" defined as datatable'),$("#"+e).on("init.dt",(function(t){for(dttable=$("#"+e).DataTable(),i=dttable.buttons().length;i>0;i--)dttable.buttons(i-1).remove();dttable.button().add(0,{text:'<i class="fa-solid fa-rotate-right"></i>',action:function(e,t,a,r){t.ajax.reload()}});const a=dttable.context[0].oInit.insertAllowed,r=dttable.context[0].oInit.onModifyActionForm;void 0!==a&&void 0!==r&&a&&dttable.button().add(0,{text:'<i class="fa-solid fa-plus"></i>',action:function(e,t,a,n){myo.UI.onClickInsertDataTable(r)}})})),tbody=table.getElementsByTagName("tbody")[0],$(tbody).on("click","tr",(function(){jQuery(this).hasClass("selected")?jQuery(this).removeClass("selected"):(dttable.$("tr.selected").removeClass("selected"),jQuery(this).addClass("selected"))}))},OnCreatedRow(e,t){let a=null;if(e.childNodes.forEach((e=>{a=e.querySelector("#dtModifyButton")})),a){const r=this.api().context[0].oInit.onModifyActionForm;if(void 0!==r){const e=document.getElementById(r);if(void 0!==e&&null!=e){const e=myo.UI.getListKeys(r,"actionread");a.setAttribute("onclick",'myo.UI.onClickModifyDataTable("'+r+'", ["'+Object.values(myo.UI.getObjKeys(e,t)).join(", ")+'"])')}else this.OnModifyActionFormAlert||(a.style.display="none")}const n=this.api().context[0].oInit.onDeleteActionForm;let o=null;if(e.childNodes.forEach((e=>{o=e.querySelector("#dtDeleteButton")})),o){const e=document.getElementById(n);if(void 0!==e&&null!=e){const e=myo.UI.getListKeys(n+"-button","action");o.setAttribute("onclick",'myo.UI.onClickDeleteDataTable("'+n+'", ["'+Object.values(myo.UI.getObjKeys(e,t)).join(", ")+'"])')}else this.OnDeleteActionFormAlert||(o.style.display="none")}}},onClickModifyDataTable(e,t){jQuery.noConflict(),this.populateFormFields(e,t),jQuery("#"+e).modal("show")},onClickInsertDataTable(e){jQuery.noConflict(),this.populateFormFields(e,[]),jQuery("#"+e).modal("show")},onClickDeleteDataTable(e,t){jQuery.noConflict();var a=this.getListKeys(e+"-button","action"),r="#"+e+"-button",n=0;a.forEach((function(e){jQuery(r)[0].dataset.actionset=jQuery(r)[0].dataset.action.replace("{"+e+"}",t[n]),n++})),jQuery("#"+e).modal("show")},validateEmailField:(e,t)=>!!/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e.value).toLowerCase())||(myo.UI.raiseAlert(myo.UI.alertType.OperativeError,"Invalid email!"),t.preventDefault(),e.focus(),!1),populateFormFields(e,t){var a=jQuery("#"+e)[0],r=this.getListKeys(e,"actionread");if(0==t.length)return myo.UI.clearFields(a,r),!0;if(0==r.count)return!1;if(!("actionread"in a.dataset))return window.alert("The actionread parameter in the form is missing."),!1;var n=0;if(r.forEach((function(e){response=myo.WS.callReadRequest(a.dataset.actionread.replace("{"+e+"}",t[n]),document.querySelector('meta[name="csrf-token"]').getAttribute("content")),n++})),0==response.success)return window.alert("Server comunication error: "+response.data+"."),!1;myo.UI.populateFields(a,response.data)},generateDataPost(e){var t=jQuery("#"+e)[0],a={};return inputfields=t.getElementsByTagName("input"),Array.from(inputfields).forEach((function(e){if("fieldname"in e.dataset)switch(e.type){case"checkbox":a[e.dataset.fieldname]=e.checked?"1":"0";break;default:a[e.dataset.fieldname]=e.value}})),inputfields=t.getElementsByTagName("select"),Array.from(inputfields).forEach((function(e){"fieldname"in e.dataset&&Array.from(e.children).forEach((function(t){t.selected&&(void 0===a[e.dataset.fieldname]?a[e.dataset.fieldname]=t.value:a[e.dataset.fieldname]=a[e.dataset.fieldname]+"|"+t.value)}))})),a},getListKeys(e,t){const a=/\{(.*?)\}/g;var r=jQuery("#"+e)[0],n=[];if(void 0!==r.dataset[t]){let e;for(;e=a.exec(r.dataset[t]);)n.push(e[1])}return n},getObjKeys:(e,t)=>(objKey={},e.forEach((function(e){e in t&&(objKey[e]=t[e])})),objKey),clearFields(e,t){inputfields=e.getElementsByTagName("input"),Array.from(inputfields).forEach((function(e){if(t.includes(e.name))e.value=this.newRecordUUID;else if("fieldname"in e.dataset)switch(e.type){case"checkbox":e.checked=!1;break;default:e.value=""}})),inputfields=e.getElementsByTagName("select"),Array.from(inputfields).forEach((function(e){"fieldname"in e.dataset&&(e.hasAttribute("data-ajax--url")?Array.from(e.children).forEach((function(t){e.remove(t)})):Array.from(e.children).forEach((function(e){e.selected=!1})))}))},populateFields(e,t){inputfields=e.getElementsByTagName("input"),Array.from(inputfields).forEach((function(e){if("fieldname"in e.dataset&&(e.value="",e.dataset.fieldname in t&&"fieldname"in e.dataset))switch(e.type){case"checkbox":e.checked="1"===t[e.dataset.fieldname],myo.UI.changeField(e);break;default:e.value=t[e.dataset.fieldname]}})),inputfields=e.getElementsByTagName("select"),Array.from(inputfields).forEach((function(e){if("fieldname"in e.dataset&&e.dataset.fieldname in t){if(e.hasAttribute("data-ajax--url"))e.innerHTML="",url=e.getAttribute("data-ajax--url"),t[e.dataset.fieldname].hasOwnProperty("split")?selected=t[e.dataset.fieldname].split("|"):selected=[t[e.dataset.fieldname]],selected.forEach((function(t){response=myo.WS.callReadRequest(url+"/"+t,document.querySelector('meta[name="csrf-token"]').getAttribute("content")),optionElement=document.createElement("option"),optionElement.value=t,optionElement.textContent=response.data.text,optionElement.setAttribute("selected",null),e.appendChild(optionElement)}));else{var a="|"+t[e.dataset.fieldname]+"|";Array.from(e.childNodes).forEach((function(e){e.selected=a.includes("|"+e.value+"|")}))}myo.UI.changeField(e)}})),inputfields=e.getElementsByTagName("textarea"),Array.from(inputfields).forEach((function(e){if("fieldname"in e.dataset&&(e.value="",e.dataset.fieldname in t&&"fieldname"in e.dataset))switch(e.type){case"checkbox":e.checked="1"===t[e.dataset.fieldname],myo.UI.changeField(e);break;default:e.value=t[e.dataset.fieldname]}}))},changeField(e){var t=new Event("change");e.dispatchEvent(t)},processAlert(e){switch(!0){case e.hasOwnProperty("_operativeSuccess"):return myo.UI.raiseAlert(myo.UI.alertType.OperativeSuccess,e._operativeSuccess.message),!0;case e.hasOwnProperty("_operativeInfo"):return myo.UI.raiseAlert(myo.UI.alertType.OperativeInfo,e._operativeInfo.message),!0;case e.hasOwnProperty("_operativeWarning"):return myo.UI.raiseAlert(myo.UI.alertType.OperativeWarning,e._operativeWarning.message),!0;case e.hasOwnProperty("_operativeError"):return myo.UI.raiseAlert(myo.UI.alertType.OperativeError,e._operativeError.message),!1;case e.hasOwnProperty("_runtimeError"):return myo.UI.raiseAlert(myo.UI.alertType.RuntimeError,e._runtimeError.message),!1}return!0},raiseAlert(e,t){switch(e){case myo.UI.alertType.OperativeSuccess:Swal.fire({position:"top-end",type:"success",icon:"success",text:t,showConfirmButton:!1,timer:1500});break;case myo.UI.alertType.OperativeInfo:Swal.fire({text:t,type:"info",icon:"info"});break;case myo.UI.alertType.OperativeWarning:Swal.fire({text:t,type:"warning",icon:"warning"});break;case myo.UI.alertType.OperativeError:Swal.fire({text:t,type:"error",icon:"error"});break;case myo.UI.alertType.RuntimeError:Swal.fire({text:t,type:"error",icon:"error",iconHtml:"!"});break}}},WS:{callReadRequest(e,t){var a=[success=!1,data=null];return jQuery.ajax({url:e,method:"GET",async:!1,data:{_token:t},success:function(e){conclusion=myo.UI.processAlert(e),a.success=conclusion,a.data=e},error:function(e){myo.UI.processAlert({_runtimeError:{message:e.responseText}}),conclusion=!1,a.success=conclusion}}),a},callUpdateRequest(e,t,a){var r=!1,n=myo.UI.generateDataPost(e);return n._token=a,jQuery.ajax({url:t,type:"POST",async:!1,data:n,success:function(e){r=myo.UI.processAlert(e)},error:function(e){try{r=myo.UI.processAlert(JSON.parse(e.responseText))}catch(t){myo.UI.processAlert({_runtimeError:{message:e.responseText}})}r=!1}}),r},callDeleteRequest(e,t){var a=!1;return jQuery.ajax({url:e,type:"DELETE",async:!1,data:{_token:t},success:function(e){a=myo.UI.processAlert(e)},error:function(e){myo.UI.processAlert({_runtimeError:{message:e.responseText}}),a=!1}}),a}}};